---
phase: 02-dashboard-core-display
plan: 06
type: execute
wave: 3
depends_on: ["02-04", "02-05"]
files_modified:
  - dashboard/src/pages/Apps.tsx
  - dashboard/src/pages/Apps.module.css
  - dashboard/src/pages/AppDetail.tsx
  - dashboard/src/pages/AppDetail.module.css
  - dashboard/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can view list of apps with repository and failure counts"
    - "Clicking an app navigates to detail page"
    - "App detail shows repositories linked to that app"
    - "Empty state shown when no apps exist"
  artifacts:
    - path: "dashboard/src/pages/Apps.tsx"
      provides: "Apps list page"
      contains: "fetchApps"
    - path: "dashboard/src/pages/AppDetail.tsx"
      provides: "App detail page with repositories"
      contains: "fetchAppDetail"
  key_links:
    - from: "dashboard/src/pages/Apps.tsx"
      to: "/admin/apps/:appId"
      via: "Link navigation"
      pattern: "Link.*to=.*apps/"
---

<objective>
Create Apps list page and AppDetail page with repositories display.

Purpose: Allow admin to view registered apps and their linked repositories.
Output: Apps page with card list, AppDetail page showing app info and repositories table.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dashboard-core-display/02-CONTEXT.md
@.planning/phases/02-dashboard-core-display/02-RESEARCH.md
@dashboard/src/api/admin.ts
@dashboard/src/hooks/usePolling.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Apps list page</name>
  <files>dashboard/src/pages/Apps.tsx, dashboard/src/pages/Apps.module.css</files>
  <action>
1. Create `dashboard/src/pages/Apps.module.css`:

```css
.container {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.title {
  margin: 0;
  font-size: 1.5rem;
  font-weight: 600;
  color: #111827;
}

.refreshInfo {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
  color: #6b7280;
}

.appGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 1rem;
}

.appCard {
  background-color: white;
  border-radius: 0.5rem;
  padding: 1.25rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  text-decoration: none;
  color: inherit;
  transition: box-shadow 0.15s, transform 0.15s;
}

.appCard:hover {
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transform: translateY(-1px);
}

.appName {
  margin: 0 0 0.5rem;
  font-size: 1.125rem;
  font-weight: 600;
  color: #111827;
}

.appUrl {
  margin: 0 0 1rem;
  font-size: 0.875rem;
  color: #6b7280;
  word-break: break-all;
}

.appStats {
  display: flex;
  gap: 1.5rem;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
}

.stat {
  display: flex;
  flex-direction: column;
}

.statLabel {
  font-size: 0.75rem;
  color: #6b7280;
}

.statValue {
  font-size: 1.25rem;
  font-weight: 600;
  color: #111827;
}

.statValueError {
  color: #dc2626;
}

.emptyState {
  text-align: center;
  padding: 3rem;
  color: #6b7280;
}

.emptyTitle {
  margin: 0 0 0.5rem;
  font-size: 1.125rem;
  font-weight: 500;
  color: #374151;
}

.emptyText {
  margin: 0;
  font-size: 0.875rem;
}

.loadingState {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 200px;
  color: #6b7280;
}

.spin {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.refreshButton {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.375rem 0.75rem;
  background-color: white;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  color: #374151;
  font-size: 0.875rem;
  cursor: pointer;
  transition: background-color 0.15s;
}

.refreshButton:hover:not(:disabled) {
  background-color: #f9fafb;
}

.refreshButton:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
```

2. Create `dashboard/src/pages/Apps.tsx`:

```typescript
import { Link } from "react-router";
import { formatDistanceToNow } from "date-fns";
import { RefreshCw, Loader2, Boxes } from "lucide-react";
import { usePollingQuery } from "../hooks/usePolling";
import { fetchApps } from "../api/admin";
import styles from "./Apps.module.css";

export function Apps() {
  const { data: apps, isLoading, dataUpdatedAt, refetch, isFetching } = usePollingQuery(
    ["apps"],
    fetchApps
  );

  if (isLoading) {
    return (
      <div className={styles.loadingState}>
        <Loader2 size={24} className={styles.spin} />
        <span style={{ marginLeft: "0.5rem" }}>Loading apps...</span>
      </div>
    );
  }

  const lastUpdated = dataUpdatedAt
    ? formatDistanceToNow(new Date(dataUpdatedAt), { addSuffix: true })
    : "never";

  return (
    <div className={styles.container}>
      <div className={styles.header}>
        <h1 className={styles.title}>Registered Apps</h1>
        <div className={styles.refreshInfo}>
          <span>Updated {lastUpdated}</span>
          <button
            onClick={() => refetch()}
            disabled={isFetching}
            className={styles.refreshButton}
          >
            <RefreshCw size={14} className={isFetching ? styles.spin : ""} />
            Refresh
          </button>
        </div>
      </div>

      {!apps || apps.length === 0 ? (
        <div className={styles.emptyState}>
          <Boxes size={48} style={{ marginBottom: "1rem", opacity: 0.5 }} />
          <p className={styles.emptyTitle}>No apps registered</p>
          <p className={styles.emptyText}>
            Apps will appear here once clients register via the API.
          </p>
        </div>
      ) : (
        <div className={styles.appGrid}>
          {apps.map((app) => (
            <Link
              key={app.app_id}
              to={`/apps/${app.app_id}`}
              className={styles.appCard}
            >
              <h2 className={styles.appName}>{app.app_name}</h2>
              <p className={styles.appUrl}>{app.base_url}</p>
              <div className={styles.appStats}>
                <div className={styles.stat}>
                  <span className={styles.statLabel}>Repositories</span>
                  <span className={styles.statValue}>{app.repository_count}</span>
                </div>
                <div className={styles.stat}>
                  <span className={styles.statLabel}>Failed</span>
                  <span
                    className={`${styles.statValue} ${app.failed_notification_count > 0 ? styles.statValueError : ""}`}
                  >
                    {app.failed_notification_count}
                  </span>
                </div>
              </div>
            </Link>
          ))}
        </div>
      )}
    </div>
  );
}
```
  </action>
  <verify>Run `cd dashboard && pnpm typecheck` to verify types compile</verify>
  <done>Apps list page created with cards showing app name, URL, repository count, and failure count</done>
</task>

<task type="auto">
  <name>Task 2: Create AppDetail page and update routes</name>
  <files>dashboard/src/pages/AppDetail.tsx, dashboard/src/pages/AppDetail.module.css, dashboard/src/App.tsx</files>
  <action>
1. Create `dashboard/src/pages/AppDetail.module.css`:

```css
.container {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.backLink {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  color: #6b7280;
  text-decoration: none;
  font-size: 0.875rem;
}

.backLink:hover {
  color: #374151;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.headerInfo {
  flex: 1;
}

.title {
  margin: 0 0 0.25rem;
  font-size: 1.5rem;
  font-weight: 600;
  color: #111827;
}

.url {
  margin: 0;
  font-size: 0.875rem;
  color: #6b7280;
  word-break: break-all;
}

.refreshInfo {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
  color: #6b7280;
}

.infoCard {
  background-color: white;
  border-radius: 0.5rem;
  padding: 1.25rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.infoGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.infoItem {
  display: flex;
  flex-direction: column;
}

.infoLabel {
  font-size: 0.75rem;
  color: #6b7280;
  margin-bottom: 0.25rem;
}

.infoValue {
  font-size: 0.875rem;
  color: #111827;
}

.section {
  margin-top: 1rem;
}

.sectionTitle {
  margin: 0 0 1rem;
  font-size: 1.125rem;
  font-weight: 600;
  color: #111827;
}

.table {
  width: 100%;
  background-color: white;
  border-radius: 0.5rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border-collapse: collapse;
  overflow: hidden;
}

.table th,
.table td {
  padding: 0.75rem 1rem;
  text-align: left;
}

.table th {
  background-color: #f9fafb;
  font-size: 0.75rem;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.table td {
  font-size: 0.875rem;
  color: #374151;
  border-top: 1px solid #e5e7eb;
}

.table tbody tr:hover {
  background-color: #f9fafb;
}

.repoLink {
  color: #3b82f6;
  text-decoration: none;
}

.repoLink:hover {
  text-decoration: underline;
}

.statusBadge {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.25rem 0.5rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 500;
}

.statusSynced {
  background-color: #dcfce7;
  color: #166534;
}

.statusFailed {
  background-color: #fef2f2;
  color: #dc2626;
}

.statusPending {
  background-color: #fef3c7;
  color: #92400e;
}

.statusScanning {
  background-color: #dbeafe;
  color: #1e40af;
}

.circuitBadge {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.125rem 0.375rem;
  background-color: #fef2f2;
  color: #dc2626;
  border-radius: 0.25rem;
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  margin-left: 0.5rem;
}

.emptyRepos {
  text-align: center;
  padding: 2rem;
  color: #6b7280;
}

.loadingState {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 200px;
  color: #6b7280;
}

.spin {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.refreshButton {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.375rem 0.75rem;
  background-color: white;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  color: #374151;
  font-size: 0.875rem;
  cursor: pointer;
  transition: background-color 0.15s;
}

.refreshButton:hover:not(:disabled) {
  background-color: #f9fafb;
}

.refreshButton:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.notFound {
  text-align: center;
  padding: 3rem;
  color: #6b7280;
}
```

2. Create `dashboard/src/pages/AppDetail.tsx`:

```typescript
import { Link, useParams } from "react-router";
import { formatDistanceToNow, format } from "date-fns";
import {
  ArrowLeft,
  RefreshCw,
  Loader2,
  Check,
  X,
  Clock,
  Zap,
} from "lucide-react";
import { usePollingQuery } from "../hooks/usePolling";
import { fetchAppDetail } from "../api/admin";
import type { RepositorySummary } from "@docora/shared-types";
import styles from "./AppDetail.module.css";

function StatusBadge({ status }: { status: RepositorySummary["status"] }) {
  const config = {
    synced: { icon: Check, className: styles.statusSynced, label: "Synced" },
    failed: { icon: X, className: styles.statusFailed, label: "Failed" },
    pending_snapshot: {
      icon: Clock,
      className: styles.statusPending,
      label: "Pending",
    },
    scanning: { icon: Zap, className: styles.statusScanning, label: "Scanning" },
  };

  const { icon: Icon, className, label } = config[status];

  return (
    <span className={`${styles.statusBadge} ${className}`}>
      <Icon size={12} />
      {label}
    </span>
  );
}

export function AppDetail() {
  const { appId } = useParams<{ appId: string }>();

  const {
    data: app,
    isLoading,
    dataUpdatedAt,
    refetch,
    isFetching,
    error,
  } = usePollingQuery(["app", appId!], () => fetchAppDetail(appId!), {
    enabled: !!appId,
  });

  if (isLoading) {
    return (
      <div className={styles.loadingState}>
        <Loader2 size={24} className={styles.spin} />
        <span style={{ marginLeft: "0.5rem" }}>Loading app details...</span>
      </div>
    );
  }

  if (error || !app) {
    return (
      <div className={styles.container}>
        <Link to="/apps" className={styles.backLink}>
          <ArrowLeft size={16} />
          Back to Apps
        </Link>
        <div className={styles.notFound}>
          <p>App not found or failed to load.</p>
        </div>
      </div>
    );
  }

  const lastUpdated = dataUpdatedAt
    ? formatDistanceToNow(new Date(dataUpdatedAt), { addSuffix: true })
    : "never";

  return (
    <div className={styles.container}>
      <Link to="/apps" className={styles.backLink}>
        <ArrowLeft size={16} />
        Back to Apps
      </Link>

      <div className={styles.header}>
        <div className={styles.headerInfo}>
          <h1 className={styles.title}>{app.app_name}</h1>
          <p className={styles.url}>{app.base_url}</p>
        </div>
        <div className={styles.refreshInfo}>
          <span>Updated {lastUpdated}</span>
          <button
            onClick={() => refetch()}
            disabled={isFetching}
            className={styles.refreshButton}
          >
            <RefreshCw size={14} className={isFetching ? styles.spin : ""} />
            Refresh
          </button>
        </div>
      </div>

      <div className={styles.infoCard}>
        <div className={styles.infoGrid}>
          <div className={styles.infoItem}>
            <span className={styles.infoLabel}>App ID</span>
            <span className={styles.infoValue}>{app.app_id}</span>
          </div>
          <div className={styles.infoItem}>
            <span className={styles.infoLabel}>Email</span>
            <span className={styles.infoValue}>{app.email}</span>
          </div>
          <div className={styles.infoItem}>
            <span className={styles.infoLabel}>Website</span>
            <span className={styles.infoValue}>{app.website || "â€”"}</span>
          </div>
          <div className={styles.infoItem}>
            <span className={styles.infoLabel}>Created</span>
            <span className={styles.infoValue}>
              {format(new Date(app.created_at), "MMM d, yyyy")}
            </span>
          </div>
          <div className={styles.infoItem}>
            <span className={styles.infoLabel}>Repositories</span>
            <span className={styles.infoValue}>{app.repository_count}</span>
          </div>
          <div className={styles.infoItem}>
            <span className={styles.infoLabel}>Failed Notifications</span>
            <span className={styles.infoValue}>{app.failed_notification_count}</span>
          </div>
        </div>
        {app.description && (
          <div className={styles.infoItem} style={{ marginTop: "1rem" }}>
            <span className={styles.infoLabel}>Description</span>
            <span className={styles.infoValue}>{app.description}</span>
          </div>
        )}
      </div>

      <div className={styles.section}>
        <h2 className={styles.sectionTitle}>Repositories</h2>

        {app.repositories.length === 0 ? (
          <div className={styles.emptyRepos}>
            <p>No repositories linked to this app yet.</p>
          </div>
        ) : (
          <table className={styles.table}>
            <thead>
              <tr>
                <th>Repository</th>
                <th>Status</th>
                <th>Last Scanned</th>
              </tr>
            </thead>
            <tbody>
              {app.repositories.map((repo) => (
                <tr key={repo.repository_id}>
                  <td>
                    <a
                      href={repo.github_url}
                      target="_blank"
                      rel="noopener noreferrer"
                      className={styles.repoLink}
                    >
                      {repo.owner}/{repo.name}
                    </a>
                    {repo.circuit_open && (
                      <span className={styles.circuitBadge}>Circuit Open</span>
                    )}
                  </td>
                  <td>
                    <StatusBadge status={repo.status} />
                  </td>
                  <td>
                    {repo.last_scanned_at
                      ? formatDistanceToNow(new Date(repo.last_scanned_at), {
                          addSuffix: true,
                        })
                      : "Never"}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
}
```

3. Update `dashboard/src/App.tsx` to import the real page components:

```typescript
import { BrowserRouter, Routes, Route } from "react-router";
import { AuthProvider } from "./context/AuthContext";
import { ProtectedRoute } from "./components/ProtectedRoute";
import { Layout } from "./components/Layout";
import { Login } from "./pages/Login";
import { Dashboard } from "./pages/Dashboard";
import { Apps } from "./pages/Apps";
import { AppDetail } from "./pages/AppDetail";

// Placeholder pages - will be implemented in next plan
function RepositoriesPage() {
  return <div>Repositories page - coming soon</div>;
}
function NotificationsPage() {
  return <div>Notifications page - coming soon</div>;
}
function QueuePage() {
  return <div>Queue page - coming soon</div>;
}

export function App() {
  return (
    <BrowserRouter basename="/admin">
      <AuthProvider>
        <Routes>
          <Route path="/login" element={<Login />} />
          <Route element={<ProtectedRoute />}>
            <Route element={<Layout />}>
              <Route index element={<Dashboard />} />
              <Route path="apps" element={<Apps />} />
              <Route path="apps/:appId" element={<AppDetail />} />
              <Route path="repositories" element={<RepositoriesPage />} />
              <Route path="notifications" element={<NotificationsPage />} />
              <Route path="queue" element={<QueuePage />} />
            </Route>
          </Route>
        </Routes>
      </AuthProvider>
    </BrowserRouter>
  );
}
```
  </action>
  <verify>
1. Run `cd dashboard && pnpm typecheck` to verify types
2. Run `cd dashboard && pnpm build` to ensure build succeeds
  </verify>
  <done>Apps list and AppDetail pages created, clicking app navigates to detail page showing app info and repositories table</done>
</task>

</tasks>

<verification>
1. `cd dashboard && pnpm typecheck` passes
2. `cd dashboard && pnpm build` succeeds
3. Apps page shows list of apps in cards
4. Clicking app card navigates to /apps/:appId
5. AppDetail shows app info and repositories table
6. Empty states work when no apps/repos exist
</verification>

<success_criteria>
- Apps page displays cards with app name, URL, repo count, failure count
- Empty state shown when no apps registered
- Clicking app navigates to /apps/:appId detail page
- AppDetail shows app metadata (email, website, description, created date)
- AppDetail shows repositories table with status badges
- Circuit open indicator shown for repositories with open circuit breaker
- Data auto-refreshes every 10 seconds on both pages
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-core-display/02-06-SUMMARY.md`
</output>
