---
phase: 02-dashboard-core-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/shared-types/src/dashboard.ts
  - packages/shared-types/src/index.ts
  - dashboard/package.json
  - dashboard/src/main.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard types are shared between frontend and backend"
    - "TanStack Query is configured for data fetching"
    - "Toast notifications are available for error display"
  artifacts:
    - path: "packages/shared-types/src/dashboard.ts"
      provides: "Dashboard API types"
      contains: "AppSummary"
    - path: "dashboard/src/main.tsx"
      provides: "QueryClient provider setup"
      contains: "QueryClientProvider"
  key_links:
    - from: "dashboard/src/main.tsx"
      to: "@tanstack/react-query"
      via: "QueryClientProvider wrapper"
      pattern: "QueryClientProvider"
---

<objective>
Add dashboard types to shared-types package and configure TanStack Query with toast notifications in the dashboard.

Purpose: Establish type-safe API contracts and data fetching infrastructure before building UI pages.
Output: Shared types for dashboard APIs, TanStack Query configured with default options, toast notifications ready for use.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dashboard-core-display/02-RESEARCH.md
@packages/shared-types/src/admin.ts
@packages/shared-types/src/index.ts
@dashboard/src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add dashboard types to shared-types package</name>
  <files>packages/shared-types/src/dashboard.ts, packages/shared-types/src/index.ts</files>
  <action>
Create `packages/shared-types/src/dashboard.ts` with types matching the research:

```typescript
/** App summary for list view */
export interface AppSummary {
  app_id: string;
  app_name: string;
  base_url: string;
  created_at: string;
  repository_count: number;
  failed_notification_count: number;
}

/** Repository summary for list view */
export interface RepositorySummary {
  repository_id: string;
  github_url: string;
  owner: string;
  name: string;
  status: 'pending_snapshot' | 'scanning' | 'synced' | 'failed';
  last_scanned_at: string | null;
  circuit_open: boolean;
}

/** App detail with related data */
export interface AppDetail extends AppSummary {
  email: string;
  website: string | null;
  description: string | null;
  repositories: RepositorySummary[];
}

/** Failed notification entry */
export interface FailedNotification {
  app_id: string;
  app_name: string;
  repository_id: string;
  repository_name: string;
  github_url: string;
  error_message: string;
  timestamp: string;
  retry_count: number;
}

/** BullMQ queue status */
export interface QueueStatus {
  waiting: number;
  active: number;
  completed: number;
  failed: number;
  delayed: number;
}

/** Queue job summary */
export interface QueueJob {
  id: string;
  name: string;
  app_name: string;
  repository_name: string;
  status: 'waiting' | 'active' | 'delayed';
  created_at: string;
  processed_on: string | null;
}

/** Overview metrics for dashboard home */
export interface OverviewMetrics {
  total_apps: number;
  total_repositories: number;
  failed_notifications: number;
  queue_waiting: number;
  queue_active: number;
}

/** API response wrapper */
export interface ApiResponse<T> {
  data: T;
}

/** API error response */
export interface ApiErrorResponse {
  error: string;
}
```

Then add export to `packages/shared-types/src/index.ts`:
```typescript
export * from "./dashboard.js";
```
  </action>
  <verify>Run `pnpm typecheck` from project root to confirm types compile</verify>
  <done>Dashboard types exported from @docora/shared-types and importable in both frontend and backend</done>
</task>

<task type="auto">
  <name>Task 2: Install frontend dependencies and configure TanStack Query</name>
  <files>dashboard/package.json, dashboard/src/main.tsx</files>
  <action>
1. Install dependencies in dashboard/:
   ```bash
   cd dashboard && pnpm add @tanstack/react-query lucide-react react-hot-toast date-fns
   ```

2. Update `dashboard/src/main.tsx` to wrap app with QueryClientProvider and Toaster:

```typescript
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { Toaster } from "react-hot-toast";
import { App } from "./App";

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5_000,
      retry: 1,
      refetchOnWindowFocus: false,
    },
  },
});

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <QueryClientProvider client={queryClient}>
      <Toaster
        position="top-right"
        toastOptions={{
          duration: 5000,
          error: {
            style: {
              background: '#fef2f2',
              color: '#dc2626',
            },
          },
        }}
      />
      <App />
    </QueryClientProvider>
  </StrictMode>
);
```

Note: Do NOT add `refetchInterval` or `refetchIntervalInBackground` to default options - those are per-query settings that individual hooks will set.
  </action>
  <verify>
1. Run `cd dashboard && pnpm build` to verify TypeScript compiles
2. Check dashboard/package.json includes @tanstack/react-query, lucide-react, react-hot-toast, date-fns
  </verify>
  <done>TanStack Query configured with QueryClientProvider, Toaster ready for error notifications</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes at project root
2. `cd dashboard && pnpm build` succeeds
3. Dashboard types are exported from @docora/shared-types
4. New dependencies present in dashboard/package.json
</verification>

<success_criteria>
- Dashboard types (AppSummary, RepositorySummary, QueueStatus, etc.) exportable from @docora/shared-types
- TanStack Query QueryClientProvider wraps the app
- Toaster component renders for toast notifications
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-core-display/02-01-SUMMARY.md`
</output>
