---
phase: 11-onboarding-lockdown
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs-site/content/_index.md
  - bruno/apps/onboard.bru
  - CLAUDE.md
autonomous: true
requirements:
  - SEC-02

must_haves:
  truths:
    - "Documentation states that onboarding requires admin authentication"
    - "No documentation references self-service onboarding or the old /api/apps/onboard endpoint"
    - "Bruno collection points to the new admin onboard endpoint with session auth"
  artifacts:
    - path: "docs-site/content/_index.md"
      provides: "Updated homepage reflecting admin-only onboarding"
      contains: "admin"
    - path: "bruno/apps/onboard.bru"
      provides: "Bruno request targeting new admin endpoint"
      contains: "/admin/api/apps/onboard"
  key_links:
    - from: "docs-site/content/_index.md"
      to: "POST /admin/api/apps/onboard"
      via: "documentation text describing admin onboarding"
      pattern: "admin"
---

<objective>
Update all documentation and API tooling to reflect that app onboarding is now admin-only, removing all references to the old public endpoint and self-service language.

Purpose: SEC-02 requires that API documentation accurately reflects the admin authentication requirement for onboarding. Stale documentation creates confusion and potential security misunderstandings.

Output: Updated Hugo docs site, Bruno API collection, and CLAUDE.md architecture section.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-onboarding-lockdown/11-CONTEXT.md
@.planning/phases/11-onboarding-lockdown/11-RESEARCH.md
@docs-site/content/_index.md
@bruno/apps/onboard.bru
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Hugo docs site to reflect admin-only onboarding</name>
  <files>
    docs-site/content/_index.md
  </files>
  <action>
Update `docs-site/content/_index.md`:

1. **"How It Works" step 1** — Change the onboarding step from self-service language to admin-only language:
   - Current: "**Onboard your app** -- Register with Docora to receive an app ID and bearer token. Docora uses these credentials to authenticate your API calls and sign webhook deliveries."
   - New: "**Onboard your app** -- An admin registers your app through the Docora admin dashboard. You receive an app ID and bearer token. Docora uses these credentials to authenticate your API calls and sign webhook deliveries."

2. **Do NOT mention the old endpoint** — per locked decision, docs only show current state. Do not reference `/api/apps/onboard` anywhere.

3. **Keep everything else unchanged** — the rest of the page content (What is Docora, Key Features, Get Started) is still accurate.

The change is minimal and factual per the locked decision: "brief, factual messaging" and "remove any self-service onboarding language."
  </action>
  <verify>
    <automated>grep -c "self-service\|/api/apps/onboard" docs-site/content/_index.md | grep -q "^0$" && echo "PASS: no stale references" || echo "FAIL: stale references found"</automated>
    <manual>Read the updated "How It Works" section and verify it mentions admin dashboard for onboarding.</manual>
  </verify>
  <done>
- "How It Works" step 1 says admin registers the app through the admin dashboard
- No references to self-service onboarding or the old `/api/apps/onboard` endpoint
- Rest of page content unchanged
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Bruno collection and CLAUDE.md</name>
  <files>
    bruno/apps/onboard.bru
    CLAUDE.md
  </files>
  <action>
1. **Update `bruno/apps/onboard.bru`:**
   - Change URL from `{{baseUrl}}/api/apps/onboard` to `{{baseUrl}}/admin/api/apps/onboard`.
   - Change `auth: none` to `auth: none` (session cookies are not natively supported by Bruno auth types, but add a comment explaining the endpoint requires admin session authentication).
   - Add a `headers` block with `Cookie: {{adminSessionCookie}}` so users can set the session cookie in their environment.
   - Keep the existing body, post-response script, and tests unchanged.

2. **Update `CLAUDE.md`** — In the Architecture section:
   - Under "**Routes:**", change the entry for `src/routes/apps/onboard.ts` from `POST /api/apps/onboard (app registration)` to reflect the new location. Remove the `src/routes/apps/onboard.ts` line entirely.
   - Add a new line under the admin routes section or update the existing description to note: `src/routes/admin/onboard.ts` - `POST /admin/api/apps/onboard` (admin-only app registration).
   - In the "**Data Flow**" section of ARCHITECTURE.md (if referenced in CLAUDE.md), the "App Registration Flow" step 1 should now say `POST /admin/api/apps/onboard (admin session required)` instead of `POST /api/apps/onboard (public)`.
   - In "**Authentication:**" cross-cutting concerns, update the "Public routes" line to remove the mention of onboard as a public route example, since it is no longer public.
  </action>
  <verify>
    <automated>grep -c "/api/apps/onboard" bruno/apps/onboard.bru | grep -q "^0$" && echo "PASS: Bruno updated" || echo "FAIL: Bruno still has old URL"</automated>
    <manual>Verify CLAUDE.md architecture section references the new admin onboard route path.</manual>
  </verify>
  <done>
- Bruno collection targets `/admin/api/apps/onboard` with session cookie header
- CLAUDE.md architecture section references `src/routes/admin/onboard.ts` for admin-only onboarding
- No remaining references to `src/routes/apps/onboard.ts` or the old public endpoint in any documentation
  </done>
</task>

</tasks>

<verification>
1. `grep -r "/api/apps/onboard" docs-site/ bruno/ CLAUDE.md` returns zero matches (all old references removed)
2. `docs-site/content/_index.md` mentions admin dashboard for onboarding
3. `bruno/apps/onboard.bru` targets the new admin endpoint
4. `CLAUDE.md` architecture section lists admin onboard route correctly
</verification>

<success_criteria>
- SEC-02 satisfied: all documentation reflects admin-only onboarding
- No stale references to old endpoint or self-service language in any docs
- Bruno collection functional with new endpoint
</success_criteria>

<output>
After completion, create `.planning/phases/11-onboarding-lockdown/11-02-SUMMARY.md`
</output>
