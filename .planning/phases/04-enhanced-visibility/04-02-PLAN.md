---
phase: 04-enhanced-visibility
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - dashboard/src/hooks/useTableParams.ts
  - dashboard/src/hooks/useDebouncedValue.ts
  - dashboard/src/components/DataTable.tsx
  - dashboard/src/components/DataTable.module.css
  - dashboard/src/components/Pagination.tsx
  - dashboard/src/components/Pagination.module.css
  - dashboard/src/components/FilterBar.tsx
  - dashboard/src/components/FilterBar.module.css
  - dashboard/src/components/FilterChips.tsx
  - dashboard/src/components/FilterChips.module.css
autonomous: true
user_setup: []

must_haves:
  truths:
    - "DataTable renders sortable column headers with chevron indicators"
    - "Clicking a sortable column header cycles: unsorted -> ascending -> descending -> unsorted"
    - "Pagination shows numbered page buttons, result count, and page size selector"
    - "FilterBar provides collapsible panel with search box and filter controls"
    - "FilterChips show active filters above the table with individual remove buttons"
    - "useTableParams syncs all table state to URL search params"
    - "Changing any filter/search/sort resets page to 1"
  artifacts:
    - path: "dashboard/src/components/DataTable.tsx"
      provides: "Reusable sortable table component"
      exports: ["DataTable", "Column"]
    - path: "dashboard/src/components/Pagination.tsx"
      provides: "Page navigation with size selector"
      exports: ["Pagination"]
    - path: "dashboard/src/components/FilterBar.tsx"
      provides: "Collapsible filter panel with search"
      exports: ["FilterBar", "FilterConfig"]
    - path: "dashboard/src/components/FilterChips.tsx"
      provides: "Active filter chip display"
      exports: ["FilterChips"]
    - path: "dashboard/src/hooks/useTableParams.ts"
      provides: "URL-synced table state hook"
      exports: ["useTableParams"]
    - path: "dashboard/src/hooks/useDebouncedValue.ts"
      provides: "Debounced value hook for search input"
      exports: ["useDebouncedValue"]
  key_links:
    - from: "dashboard/src/components/DataTable.tsx"
      to: "dashboard/src/hooks/useTableParams.ts"
      via: "sortBy and sortOrder props from hook"
      pattern: "onSort"
    - from: "dashboard/src/components/FilterBar.tsx"
      to: "dashboard/src/hooks/useDebouncedValue.ts"
      via: "debounced search input"
      pattern: "useDebouncedValue"
---

<objective>
Create all reusable frontend components for table display, pagination, filtering, and sorting.

Purpose: These shared components will be used by every dashboard page in Plans 03 and 04. Building them first ensures consistent UX and avoids duplication across page rewrites.

Output: DataTable, Pagination, FilterBar, FilterChips components + useTableParams, useDebouncedValue hooks.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-enhanced-visibility/04-RESEARCH.md
@.planning/phases/04-enhanced-visibility/04-01-SUMMARY.md

@dashboard/src/pages/Apps.module.css
@dashboard/src/pages/Repositories.module.css
@dashboard/src/hooks/usePolling.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: useTableParams and useDebouncedValue hooks</name>
  <files>
    dashboard/src/hooks/useTableParams.ts
    dashboard/src/hooks/useDebouncedValue.ts
  </files>
  <action>
    1. **Create `dashboard/src/hooks/useDebouncedValue.ts`:**
       - Export `useDebouncedValue<T>(value: T, delay: number): T`
       - Uses `useState` + `useEffect` with `setTimeout` / cleanup pattern
       - Returns debounced value after `delay` ms of no changes
       - Standard React debounce hook pattern

    2. **Create `dashboard/src/hooks/useTableParams.ts`:**
       - Import `useSearchParams` from `react-router` and `useCallback` from `react`
       - Export interface `TableParamsDefaults`: `{ sortBy: string; sortOrder: 'asc' | 'desc' }`
       - Export `useTableParams(defaults: TableParamsDefaults)` hook
       - Read from URL search params:
         - `page`: `Number(searchParams.get('page')) || 1`
         - `limit`: `Number(searchParams.get('limit')) || 20`
         - `sortBy`: `searchParams.get('sort_by') || defaults.sortBy`
         - `sortOrder`: `(searchParams.get('sort_order') || defaults.sortOrder) as 'asc' | 'desc'`
         - `search`: `searchParams.get('search') || ''`
       - Export `updateParams(updates: Record<string, string | null>)` callback:
         - Creates new URLSearchParams from current
         - Sets or deletes each key based on value (null/empty = delete)
         - If `page` is NOT in updates, reset page to '1' (per user decision: filter change resets page)
         - Uses `setSearchParams(next, { replace: true })` to avoid polluting browser history
       - Export `getFilter(key: string): string` — reads arbitrary filter from URL params
       - Export `setFilter(key: string, value: string | null)` — sets filter + resets page to 1
       - Export `clearAllFilters()` — removes search, all filter keys, resets page to 1
       - Return object: `{ page, limit, sortBy, sortOrder, search, updateParams, getFilter, setFilter, clearAllFilters, searchParams }`
  </action>
  <verify>
    Run `cd /home/toto/scm-projects/docora/dashboard && pnpm exec tsc --noEmit` to verify types compile.
  </verify>
  <done>
    Both hooks export correctly. useTableParams reads/writes URL search params. useDebouncedValue returns debounced value. TypeScript compiles without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: DataTable and Pagination components</name>
  <files>
    dashboard/src/components/DataTable.tsx
    dashboard/src/components/DataTable.module.css
    dashboard/src/components/Pagination.tsx
    dashboard/src/components/Pagination.module.css
  </files>
  <action>
    1. **Create `dashboard/src/components/DataTable.tsx`:**
       - Import `ChevronUp`, `ChevronDown`, `ChevronsUpDown` from `lucide-react`
       - Export `Column<T>` interface: `{ key: string; label: string; sortable?: boolean; render: (item: T) => React.ReactNode }`
       - Export `DataTable<T>` component with props:
         - `columns: Column<T>[]`
         - `data: T[]`
         - `sortBy: string`
         - `sortOrder: 'asc' | 'desc'`
         - `onSort: (columnKey: string) => void`
         - `rowKey: (item: T) => string`
         - `isLoading?: boolean` (optional, shows faded rows during placeholderData transitions)
       - Render `<table>` with `<thead>` containing sortable headers
       - Each sortable header: clickable, shows sort icon based on state:
         - Column !== sortBy: `ChevronsUpDown` (neutral gray)
         - Column === sortBy && asc: `ChevronUp`
         - Column === sortBy && desc: `ChevronDown`
       - `onSort` handler: called with column key. The PARENT page handles the cycling logic:
         - If column !== current sortBy: set to this column ascending
         - If column === sortBy && asc: switch to desc
         - If column === sortBy && desc: clear sort (reset to default)
       - `<tbody>` maps data with `rowKey` for React keys
       - When `isLoading` is true, add opacity 0.6 class to tbody
       - Style with CSS Modules matching existing dashboard theme (white bg, #e5e7eb borders, #111827 text, hover rows #f9fafb)

    2. **Create `dashboard/src/components/DataTable.module.css`:**
       - Table: `width: 100%; border-collapse: collapse; background: white; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden`
       - Header cells: `padding: 0.75rem 1rem; text-align: left; font-size: 0.75rem; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #e5e7eb; background: #f9fafb`
       - Sortable header: `cursor: pointer; user-select: none; display: flex; align-items: center; gap: 0.25rem`
       - Sortable header hover: `color: #111827`
       - Body cells: `padding: 0.75rem 1rem; border-bottom: 1px solid #f3f4f6; font-size: 0.875rem; color: #111827`
       - Row hover: `background: #f9fafb`
       - Loading state: `opacity: 0.6; pointer-events: none`

    3. **Create `dashboard/src/components/Pagination.tsx`:**
       - Props: `{ page: number; totalPages: number; total: number; limit: number; onPageChange: (page: number) => void; onLimitChange: (limit: number) => void; filteredTotal?: number }`
       - Shows result count: "Showing X-Y of Z results" (when filteredTotal provided: "Showing X-Y of Z results (N total)")
       - Per user decision: always show total count
       - Page size selector: dropdown with 20, 50, 100 options
       - Page buttons: Previous, numbered pages, Next
       - For many pages (>7), use ellipsis pattern: `[1] ... [4] [5] [6] ... [10]`
       - Previous/Next disabled at boundaries
       - Current page highlighted with distinct style

    4. **Create `dashboard/src/components/Pagination.module.css`:**
       - Container: `display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: white; border-radius: 0 0 0.5rem 0.5rem; border-top: 1px solid #e5e7eb`
       - Result count: `font-size: 0.875rem; color: #6b7280`
       - Page buttons: `display: flex; gap: 0.25rem`
       - Button: `padding: 0.375rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; background: white; font-size: 0.875rem; cursor: pointer`
       - Active button: `background: #3b82f6; color: white; border-color: #3b82f6`
       - Disabled: `opacity: 0.5; cursor: not-allowed`
       - Page size select: `padding: 0.375rem 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem`
  </action>
  <verify>
    Run `cd /home/toto/scm-projects/docora/dashboard && pnpm exec tsc --noEmit` to verify types compile.
  </verify>
  <done>
    DataTable renders sortable headers with chevron icons. Pagination shows numbered pages, result count, and page size selector. Both components use CSS Modules matching dashboard theme. TypeScript compiles.
  </done>
</task>

<task type="auto">
  <name>Task 3: FilterBar and FilterChips components</name>
  <files>
    dashboard/src/components/FilterBar.tsx
    dashboard/src/components/FilterBar.module.css
    dashboard/src/components/FilterChips.tsx
    dashboard/src/components/FilterChips.module.css
  </files>
  <action>
    1. **Create `dashboard/src/components/FilterBar.tsx`:**
       - Import `Search`, `Filter`, `X`, `ChevronDown`, `ChevronUp` from `lucide-react`
       - Import `useDebouncedValue` from hooks
       - Export `FilterConfig` interface: `{ key: string; label: string; options: { value: string; label: string }[] }`
       - Export `FilterBar` component with props:
         - `search: string` — current search value from URL
         - `onSearchChange: (value: string) => void` — called on debounced value change
         - `filters?: FilterConfig[]` — optional dropdown filters
         - `filterValues?: Record<string, string>` — current filter values
         - `onFilterChange?: (key: string, value: string | null) => void`
       - Per user decision: collapsible filter panel with "Filters" button
       - Layout: compact bar with search input always visible on the left, "Filters" toggle button on the right
       - Search input: text input with Search icon, placeholder "Search...", controlled input that calls `onSearchChange` with debounced value (300ms delay)
       - Use internal state for the raw search input, useEffect to sync debounced value to onSearchChange
       - Also sync external `search` prop back to internal state when it changes (for URL bookmark restore)
       - Filters panel: toggled by "Filters" button, shows below the search bar when expanded
       - Each filter: `<select>` dropdown with "All" as default option (value=""), renders options from FilterConfig
       - Filter changes call `onFilterChange` immediately (instant apply per research recommendation)

    2. **Create `dashboard/src/components/FilterBar.module.css`:**
       - Container: `margin-bottom: 1rem`
       - Top bar: `display: flex; align-items: center; gap: 0.75rem; background: white; padding: 0.75rem 1rem; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1)`
       - Search input wrapper: `flex: 1; display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; background: #f9fafb`
       - Search input: `border: none; outline: none; background: transparent; flex: 1; font-size: 0.875rem; color: #111827`
       - Filters toggle button: `display: flex; align-items: center; gap: 0.25rem; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; background: white; font-size: 0.875rem; cursor: pointer; color: #374151`
       - Filters toggle active: `background: #eff6ff; border-color: #3b82f6; color: #3b82f6`
       - Filters panel: `margin-top: 0.5rem; padding: 0.75rem 1rem; background: white; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; gap: 1rem; flex-wrap: wrap`
       - Filter select: `padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem; color: #374151; min-width: 150px`

    3. **Create `dashboard/src/components/FilterChips.tsx`:**
       - Props: `{ chips: { key: string; label: string; value: string }[]; onRemove: (key: string) => void; onClearAll: () => void }`
       - Only render when chips array is non-empty
       - Show each chip as a small pill: label + value + X button to remove
       - "Clear all" button at the end
       - Per research recommendation: show above table when any filter/search is active

    4. **Create `dashboard/src/components/FilterChips.module.css`:**
       - Container: `display: flex; align-items: center; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.75rem`
       - Chip: `display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.5rem; background: #eff6ff; color: #1d4ed8; border-radius: 9999px; font-size: 0.75rem; border: 1px solid #bfdbfe`
       - Chip remove button: `background: none; border: none; cursor: pointer; color: #1d4ed8; padding: 0; display: flex; align-items: center`
       - Clear all button: `background: none; border: none; cursor: pointer; color: #6b7280; font-size: 0.75rem; text-decoration: underline`
  </action>
  <verify>
    Run `cd /home/toto/scm-projects/docora/dashboard && pnpm exec tsc --noEmit` to verify types compile.
  </verify>
  <done>
    FilterBar shows search input + collapsible filter panel with dropdowns. FilterChips shows active filter pills with remove buttons and "Clear all". Both use CSS Modules. TypeScript compiles.
  </done>
</task>

</tasks>

<verification>
- All 6 new files compile without TypeScript errors
- Components follow existing dashboard styling conventions (white bg, #111827 text, rounded corners, shadows)
- DataTable sort headers show correct chevron icons for each state
- Pagination shows correct page range and handles boundary conditions
- FilterBar search input is debounced (300ms internal state management)
</verification>

<success_criteria>
All shared components (DataTable, Pagination, FilterBar, FilterChips) and hooks (useTableParams, useDebouncedValue) exist, compile, and follow the dashboard design system. Ready for page integration in Plans 03 and 04.
</success_criteria>

<output>
After completion, create `.planning/phases/04-enhanced-visibility/04-02-SUMMARY.md`
</output>
