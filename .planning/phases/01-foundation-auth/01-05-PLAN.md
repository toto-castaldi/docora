---
phase: 01-foundation-auth
plan: 05
type: execute
wave: 4
depends_on: ["01-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Admin can log in with username/password and receive session cookie"
    - "Admin session persists across browser refreshes without re-login"
    - "Admin can log out and session is invalidated"
    - "Unauthenticated requests to /admin/* redirect to login"
    - "pnpm workspace monorepo structure exists with dashboard/ and packages/shared-types/"
    - "Admin auth is isolated from client Bearer token auth"
---

<objective>
Verify complete Phase 1 implementation through manual testing of the auth flow.

Purpose: Confirm all success criteria are met before marking phase complete.
Output: Human verification of working auth flow.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-auth/01-CONTEXT.md
@.planning/phases/01-foundation-auth/01-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up test environment</name>
  <files></files>
  <action>
Prepare the environment for testing:

1. Ensure admin credentials are set in environment. Check if .env has ADMIN_USERNAME and ADMIN_PASSWORD, if not add test values:
```bash
# Check current .env
cat .env | grep -E "ADMIN_USERNAME|ADMIN_PASSWORD|ADMIN_SESSION_SECRET"

# If missing, append test values (for local testing only):
echo "ADMIN_USERNAME=admin" >> .env
echo "ADMIN_PASSWORD=admin123" >> .env
echo "ADMIN_SESSION_SECRET=$(openssl rand -base64 32)" >> .env
```

2. Build the dashboard:
```bash
pnpm dashboard:build
```

3. Start the server:
```bash
pnpm dev
```

4. Confirm server is running and ready to accept requests.
  </action>
  <verify>
- Server starts without errors
- Dashboard build exists at dashboard/dist/
- http://localhost:3000/health returns 200
  </verify>
  <done>Test environment is ready with admin credentials configured</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 1: Admin authentication flow with session-based auth, React dashboard, and monorepo structure</what-built>
  <how-to-verify>
**Test the complete authentication flow:**

1. **Unauthenticated redirect test:**
   - Open http://localhost:3000/admin/ in browser
   - Expected: Redirected to /admin/login

2. **Login with invalid credentials:**
   - On login page, enter wrong username/password
   - Click "Sign in"
   - Expected: "Invalid credentials" error appears (generic message)

3. **Login with valid credentials:**
   - Enter correct username and password (from .env: admin / admin123)
   - Click "Sign in"
   - Expected: Redirected to dashboard, shows "Logged in as: admin"

4. **Session persistence test:**
   - After logging in, refresh the page (F5)
   - Expected: Still logged in, no redirect to login

5. **Logout test:**
   - Click "Logout" button
   - Expected: Redirected to login page
   - Try accessing http://localhost:3000/admin/ again
   - Expected: Redirected to login (session destroyed)

6. **API isolation test (optional):**
   - In terminal: `curl -X POST http://localhost:3000/api/apps/onboard -H "Content-Type: application/json" -d '{"callbackUrl":"http://test.com"}'`
   - Expected: 401 with "Missing or invalid Authorization header" (NOT session-based auth)

**Monorepo structure verification:**
- `ls pnpm-workspace.yaml` - file exists
- `ls packages/shared-types/` - directory with package.json, src/
- `ls dashboard/` - directory with package.json, src/, dist/
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
All Phase 1 success criteria verified:
1. Admin can log in with username/password and receive session cookie
2. Admin session persists across browser refreshes without re-login
3. Admin can log out and session is invalidated
4. Unauthenticated requests to /admin/* redirect to login
5. pnpm workspace monorepo structure exists
6. Admin auth is isolated from client Bearer token auth
</verification>

<success_criteria>
- Human confirms login/logout flow works correctly
- Human confirms session persists across refresh
- Human confirms unauthenticated access redirects to login
- Human confirms monorepo structure exists
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-auth/01-05-SUMMARY.md`
</output>
