---
phase: 01-foundation-auth
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - dashboard/package.json
  - dashboard/tsconfig.json
  - dashboard/tsconfig.node.json
  - dashboard/vite.config.ts
  - dashboard/index.html
  - dashboard/src/main.tsx
  - dashboard/src/App.tsx
  - dashboard/src/vite-env.d.ts
  - dashboard/src/context/AuthContext.tsx
  - dashboard/src/components/ProtectedRoute.tsx
  - dashboard/src/pages/Login.tsx
  - dashboard/src/pages/Dashboard.tsx
  - dashboard/src/index.css
autonomous: true

must_haves:
  truths:
    - "Dashboard dev server runs on its own port"
    - "Login page renders with username/password form"
    - "Protected routes redirect unauthenticated users to login"
    - "AuthContext manages authentication state"
  artifacts:
    - path: "dashboard/package.json"
      provides: "Dashboard package configuration"
      contains: "react"
    - path: "dashboard/src/context/AuthContext.tsx"
      provides: "React auth state management"
      exports: ["AuthProvider", "useAuth"]
    - path: "dashboard/src/components/ProtectedRoute.tsx"
      provides: "Route protection component"
      exports: ["ProtectedRoute"]
    - path: "dashboard/src/pages/Login.tsx"
      provides: "Login page UI"
      min_lines: 40
    - path: "dashboard/vite.config.ts"
      provides: "Vite configuration with API proxy"
      contains: "proxy"
  key_links:
    - from: "dashboard/src/App.tsx"
      to: "dashboard/src/context/AuthContext.tsx"
      via: "AuthProvider wrapper"
      pattern: "AuthProvider"
    - from: "dashboard/src/components/ProtectedRoute.tsx"
      to: "dashboard/src/context/AuthContext.tsx"
      via: "useAuth hook"
      pattern: "useAuth"
    - from: "dashboard/src/pages/Login.tsx"
      to: "/admin/api/login"
      via: "fetch with credentials"
      pattern: "fetch.*admin/api/login.*credentials.*include"
    - from: "dashboard/package.json"
      to: "packages/shared-types"
      via: "workspace dependency"
      pattern: "@docora/shared-types.*workspace"
---

<objective>
Create React dashboard application with Vite, authentication context, and login page.

Purpose: Build the frontend foundation for the admin dashboard with proper auth state management and protected routing.
Output: dashboard/ folder with working React app, auth context, login page, and API proxy configuration.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-auth/01-RESEARCH.md
@.planning/phases/01-foundation-auth/01-CONTEXT.md
@.planning/phases/01-foundation-auth/01-01-SUMMARY.md
@pnpm-workspace.yaml
@packages/shared-types/src/admin.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold React dashboard with Vite</name>
  <files>
    dashboard/package.json
    dashboard/tsconfig.json
    dashboard/tsconfig.node.json
    dashboard/vite.config.ts
    dashboard/index.html
    dashboard/src/main.tsx
    dashboard/src/App.tsx
    dashboard/src/vite-env.d.ts
    dashboard/src/index.css
  </files>
  <action>
Create the dashboard React application manually (not using `pnpm create vite` to avoid interactive prompts):

1. Create `dashboard/package.json`:
```json
{
  "name": "dashboard",
  "private": true,
  "version": "0.0.1",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@docora/shared-types": "workspace:*",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "react-router": "^7.5.3"
  },
  "devDependencies": {
    "@types/react": "^19.1.8",
    "@types/react-dom": "^19.1.6",
    "@vitejs/plugin-react": "^4.5.2",
    "typescript": "^5.8.3",
    "vite": "^6.3.5"
  }
}
```

2. Create `dashboard/tsconfig.json`:
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true,
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"]
}
```

3. Create `dashboard/tsconfig.node.json`:
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
```

4. Create `dashboard/vite.config.ts`:
```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import path from "node:path";

export default defineConfig({
  plugins: [react()],
  base: "/admin/",
  build: {
    outDir: "dist",
    emptyOutDir: true,
  },
  server: {
    port: 5173,
    proxy: {
      "/admin/api": {
        target: "http://localhost:3000",
        changeOrigin: true,
      },
    },
  },
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "src"),
    },
  },
});
```

5. Create `dashboard/index.html`:
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/admin/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Docora Admin</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
```

6. Create `dashboard/src/vite-env.d.ts`:
```typescript
/// <reference types="vite/client" />
```

7. Create `dashboard/src/index.css`:
```css
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  line-height: 1.5;
  color: #333;
  background-color: #f5f5f5;
}

a {
  color: #0066cc;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}
```

8. Create `dashboard/src/main.tsx`:
```typescript
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import { App } from "./App";
import "./index.css";

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <App />
  </StrictMode>
);
```

9. Create `dashboard/src/App.tsx` (placeholder - will be expanded in Task 3):
```typescript
import { BrowserRouter, Routes, Route } from "react-router";
import { AuthProvider } from "./context/AuthContext";
import { ProtectedRoute } from "./components/ProtectedRoute";
import { Login } from "./pages/Login";
import { Dashboard } from "./pages/Dashboard";

export function App() {
  return (
    <BrowserRouter basename="/admin">
      <AuthProvider>
        <Routes>
          <Route path="/login" element={<Login />} />
          <Route element={<ProtectedRoute />}>
            <Route path="/" element={<Dashboard />} />
          </Route>
        </Routes>
      </AuthProvider>
    </BrowserRouter>
  );
}
```

Run `pnpm install` from project root to link workspace dependencies.
  </action>
  <verify>
- `ls dashboard/` shows package.json, vite.config.ts, src/
- `cat dashboard/package.json | grep @docora/shared-types` shows workspace dependency
- `pnpm install` succeeds
  </verify>
  <done>
- dashboard/ folder exists with Vite + React + TypeScript setup
- @docora/shared-types is linked as workspace dependency
- Vite proxy configured to forward /admin/api/* to backend on port 3000
- Base path set to /admin/ for deployment
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AuthContext and ProtectedRoute</name>
  <files>
    dashboard/src/context/AuthContext.tsx
    dashboard/src/components/ProtectedRoute.tsx
  </files>
  <action>
1. Create `dashboard/src/context/AuthContext.tsx`:

```typescript
import {
  createContext,
  useContext,
  useState,
  useEffect,
  useCallback,
  type ReactNode,
} from "react";
import type {
  LoginRequest,
  LoginResponse,
  SessionResponse,
} from "@docora/shared-types";

interface AuthContextType {
  isAuthenticated: boolean;
  isLoading: boolean;
  username: string | null;
  login: (username: string, password: string) => Promise<boolean>;
  logout: () => Promise<void>;
  checkSession: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | null>(null);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [isLoading, setIsLoading] = useState(true);
  const [username, setUsername] = useState<string | null>(null);

  const checkSession = useCallback(async () => {
    try {
      const res = await fetch("/admin/api/session", {
        credentials: "include",
      });
      if (res.ok) {
        const data: SessionResponse = await res.json();
        setIsAuthenticated(true);
        setUsername(data.username);
      } else {
        setIsAuthenticated(false);
        setUsername(null);
      }
    } catch {
      setIsAuthenticated(false);
      setUsername(null);
    } finally {
      setIsLoading(false);
    }
  }, []);

  // Check session on mount
  useEffect(() => {
    checkSession();
  }, [checkSession]);

  const login = async (
    usernameInput: string,
    password: string
  ): Promise<boolean> => {
    try {
      const body: LoginRequest = { username: usernameInput, password };
      const res = await fetch("/admin/api/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify(body),
      });
      if (res.ok) {
        const data: LoginResponse = await res.json();
        if (data.success) {
          setIsAuthenticated(true);
          setUsername(usernameInput);
          return true;
        }
      }
      return false;
    } catch {
      return false;
    }
  };

  const logout = async (): Promise<void> => {
    try {
      await fetch("/admin/api/logout", {
        method: "POST",
        credentials: "include",
      });
    } finally {
      setIsAuthenticated(false);
      setUsername(null);
    }
  };

  return (
    <AuthContext.Provider
      value={{
        isAuthenticated,
        isLoading,
        username,
        login,
        logout,
        checkSession,
      }}
    >
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth(): AuthContextType {
  const ctx = useContext(AuthContext);
  if (!ctx) {
    throw new Error("useAuth must be used within AuthProvider");
  }
  return ctx;
}
```

2. Create `dashboard/src/components/ProtectedRoute.tsx`:

```typescript
import { Navigate, Outlet, useLocation } from "react-router";
import { useAuth } from "../context/AuthContext";

export function ProtectedRoute() {
  const { isAuthenticated, isLoading } = useAuth();
  const location = useLocation();

  if (isLoading) {
    return (
      <div
        style={{
          display: "flex",
          justifyContent: "center",
          alignItems: "center",
          height: "100vh",
        }}
      >
        Loading...
      </div>
    );
  }

  if (!isAuthenticated) {
    // Save the attempted location for redirect after login
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  return <Outlet />;
}
```
  </action>
  <verify>
- `ls dashboard/src/context/` shows AuthContext.tsx
- `ls dashboard/src/components/` shows ProtectedRoute.tsx
- `grep -l "useAuth" dashboard/src/components/ProtectedRoute.tsx` confirms import
  </verify>
  <done>
- AuthContext provides isAuthenticated, isLoading, username, login, logout, checkSession
- useAuth hook for accessing auth context
- ProtectedRoute redirects to /login when not authenticated
- Loading state shown while checking session
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Login and Dashboard pages</name>
  <files>
    dashboard/src/pages/Login.tsx
    dashboard/src/pages/Dashboard.tsx
  </files>
  <action>
1. Create `dashboard/src/pages/Login.tsx`:

```typescript
import { useState, type FormEvent } from "react";
import { useNavigate, useLocation } from "react-router";
import { useAuth } from "../context/AuthContext";

export function Login() {
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState<string | null>(null);
  const [isSubmitting, setIsSubmitting] = useState(false);

  const { login } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();

  // Get the page they tried to visit before being redirected to login
  const from = (location.state as { from?: { pathname: string } })?.from
    ?.pathname || "/";

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault();
    setError(null);
    setIsSubmitting(true);

    try {
      const success = await login(username, password);
      if (success) {
        navigate(from, { replace: true });
      } else {
        setError("Invalid credentials");
      }
    } catch {
      setError("An error occurred. Please try again.");
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <div
      style={{
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
        minHeight: "100vh",
        backgroundColor: "#f5f5f5",
      }}
    >
      <div
        style={{
          backgroundColor: "white",
          padding: "2rem",
          borderRadius: "8px",
          boxShadow: "0 2px 10px rgba(0, 0, 0, 0.1)",
          width: "100%",
          maxWidth: "400px",
        }}
      >
        <h1
          style={{
            textAlign: "center",
            marginBottom: "1.5rem",
            color: "#333",
          }}
        >
          Docora Admin
        </h1>

        <form onSubmit={handleSubmit}>
          <div style={{ marginBottom: "1rem" }}>
            <label
              htmlFor="username"
              style={{
                display: "block",
                marginBottom: "0.5rem",
                fontWeight: 500,
              }}
            >
              Username
            </label>
            <input
              id="username"
              type="text"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              required
              disabled={isSubmitting}
              style={{
                width: "100%",
                padding: "0.75rem",
                border: "1px solid #ddd",
                borderRadius: "4px",
                fontSize: "1rem",
              }}
            />
          </div>

          <div style={{ marginBottom: "1.5rem" }}>
            <label
              htmlFor="password"
              style={{
                display: "block",
                marginBottom: "0.5rem",
                fontWeight: 500,
              }}
            >
              Password
            </label>
            <input
              id="password"
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
              disabled={isSubmitting}
              style={{
                width: "100%",
                padding: "0.75rem",
                border: "1px solid #ddd",
                borderRadius: "4px",
                fontSize: "1rem",
              }}
            />
          </div>

          {error && (
            <div
              style={{
                padding: "0.75rem",
                backgroundColor: "#fee2e2",
                color: "#dc2626",
                borderRadius: "4px",
                marginBottom: "1rem",
                textAlign: "center",
              }}
            >
              {error}
            </div>
          )}

          <button
            type="submit"
            disabled={isSubmitting}
            style={{
              width: "100%",
              padding: "0.75rem",
              backgroundColor: isSubmitting ? "#9ca3af" : "#2563eb",
              color: "white",
              border: "none",
              borderRadius: "4px",
              fontSize: "1rem",
              fontWeight: 500,
              cursor: isSubmitting ? "not-allowed" : "pointer",
            }}
          >
            {isSubmitting ? "Signing in..." : "Sign in"}
          </button>
        </form>
      </div>
    </div>
  );
}
```

2. Create `dashboard/src/pages/Dashboard.tsx` (placeholder for Phase 2):

```typescript
import { useAuth } from "../context/AuthContext";

export function Dashboard() {
  const { username, logout } = useAuth();

  const handleLogout = async () => {
    await logout();
  };

  return (
    <div style={{ padding: "2rem" }}>
      <header
        style={{
          display: "flex",
          justifyContent: "space-between",
          alignItems: "center",
          marginBottom: "2rem",
          paddingBottom: "1rem",
          borderBottom: "1px solid #e5e7eb",
        }}
      >
        <h1 style={{ margin: 0 }}>Docora Admin Dashboard</h1>
        <div style={{ display: "flex", alignItems: "center", gap: "1rem" }}>
          <span>Logged in as: {username}</span>
          <button
            onClick={handleLogout}
            style={{
              padding: "0.5rem 1rem",
              backgroundColor: "#ef4444",
              color: "white",
              border: "none",
              borderRadius: "4px",
              cursor: "pointer",
            }}
          >
            Logout
          </button>
        </div>
      </header>

      <main>
        <p style={{ color: "#6b7280" }}>
          Dashboard content will be added in Phase 2.
        </p>
      </main>
    </div>
  );
}
```
  </action>
  <verify>
- `ls dashboard/src/pages/` shows Login.tsx and Dashboard.tsx
- From dashboard directory, run `pnpm dev` to start Vite dev server
- Navigate to http://localhost:5173/admin/login to see login form
  </verify>
  <done>
- Login page with username/password form, error display, and loading state
- Dashboard page with logout button and username display
- Generic "Invalid credentials" error message (not revealing username existence)
- Post-login redirect to originally requested page
  </done>
</task>

</tasks>

<verification>
1. `pnpm install` succeeds from project root
2. `cd dashboard && pnpm dev` starts Vite dev server on port 5173
3. Navigate to http://localhost:5173/admin/ - should redirect to /admin/login
4. Navigate to http://localhost:5173/admin/login - should show login form
5. Login form displays username/password fields and submit button
6. `pnpm --filter dashboard exec -- pnpm run build` succeeds (production build)
</verification>

<success_criteria>
- dashboard/ folder exists with complete React + Vite setup
- @docora/shared-types is linked and types are used
- Vite dev server starts and serves on /admin/ base path
- API calls proxy to backend on port 3000
- Login page renders with form
- Protected routes redirect to login when not authenticated
- Dashboard shows logout button and username when authenticated
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-auth/01-03-SUMMARY.md`
</output>
