---
phase: 06-dashboard-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard/src/pages/Repositories.tsx
  - dashboard/src/pages/Repositories.module.css
  - dashboard/src/App.tsx
  - dashboard/src/components/Sidebar.tsx
  - dashboard/src/api/admin.ts
  - src/routes/admin/dashboard-api-repos.ts
  - src/routes/admin/dashboard-api.ts
  - src/repositories/admin-dashboard.ts
  - src/repositories/admin-dashboard-lists.ts
  - src/repositories/admin-dashboard-types.ts
autonomous: true

must_haves:
  truths:
    - "Admin dashboard navigation does not show a Repositories link"
    - "Navigating to /admin/repositories returns a 404"
    - "GET /admin/api/repositories returns 404 (Fastify default)"
    - "App detail page still shows its repositories correctly (no regression)"
  artifacts:
    - path: "dashboard/src/App.tsx"
      provides: "Route definitions without /repositories route"
      contains: "Route path=\"apps\""
    - path: "dashboard/src/components/Sidebar.tsx"
      provides: "Navigation without Repositories item"
      contains: "navItems"
    - path: "src/routes/admin/dashboard-api.ts"
      provides: "API route registration without reposRoutes"
      contains: "appsRoutes"
  key_links:
    - from: "dashboard/src/components/Sidebar.tsx"
      to: "dashboard/src/App.tsx"
      via: "NavLink paths must match Route paths"
      pattern: "navItems.*to:"
    - from: "dashboard/src/pages/AppDetail.tsx"
      to: "dashboard/src/pages/AppDetailRepoTable.tsx"
      via: "Props passing repositories array"
      pattern: "AppDetailRepoTable"
---

<objective>
Remove the redundant global repositories page from the admin dashboard (frontend and backend).

Purpose: Repository information is already shown per-app on the AppDetail page via AppDetailRepoTable. The global Repositories page is redundant and adds clutter to the navigation.

Output: Clean dashboard with no repositories page, no dead code, and no regressions on the app detail repositories table.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@dashboard/src/App.tsx
@dashboard/src/components/Sidebar.tsx
@dashboard/src/api/admin.ts
@src/routes/admin/dashboard-api.ts
@src/routes/admin/dashboard-api-repos.ts
@src/repositories/admin-dashboard.ts
@src/repositories/admin-dashboard-lists.ts
@src/repositories/admin-dashboard-types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove frontend repositories page, route, and navigation</name>
  <files>
    dashboard/src/pages/Repositories.tsx
    dashboard/src/pages/Repositories.module.css
    dashboard/src/App.tsx
    dashboard/src/components/Sidebar.tsx
    dashboard/src/api/admin.ts
  </files>
  <action>
    Delete the following files entirely:
    - `dashboard/src/pages/Repositories.tsx`
    - `dashboard/src/pages/Repositories.module.css`

    Modify `dashboard/src/App.tsx`:
    - Remove the import line: `import { Repositories } from "./pages/Repositories";`
    - Remove the Route element: `<Route path="repositories" element={<Repositories />} />`

    Modify `dashboard/src/components/Sidebar.tsx`:
    - Remove the nav item `{ to: "/repositories", icon: GitBranch, label: "Repositories" }` from the `navItems` array
    - Remove the `GitBranch` import from the lucide-react import statement (it is no longer used after removing the nav item)

    Modify `dashboard/src/api/admin.ts`:
    - Remove `RepositorySummary` from the shared-types import (line 4) — it is only used by `fetchRepositories`
    - Delete the entire `fetchRepositories` function (lines 105-110)

    DO NOT touch `AppDetailRepoTable.tsx` or `AppDetail.tsx` — they use `RepositorySummary` via their own import from `@docora/shared-types` and receive repo data from `fetchAppDetail`, not `fetchRepositories`.
  </action>
  <verify>
    Run `cd /home/toto/scm-projects/docora/dashboard && npx tsc --noEmit` — no type errors.
    Confirm deleted files no longer exist: `ls dashboard/src/pages/Repositories.tsx dashboard/src/pages/Repositories.module.css` should fail.
    Grep for orphaned references: `grep -r "Repositories" dashboard/src/App.tsx dashboard/src/components/Sidebar.tsx dashboard/src/api/admin.ts` should return zero matches related to the deleted page (the word "Repositories" may still appear in AppDetail context, which is fine).
  </verify>
  <done>
    Repositories page files deleted. No import, route, or nav item referencing them. fetchRepositories API function removed. Dashboard compiles without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove backend repositories endpoint and dead data access code</name>
  <files>
    src/routes/admin/dashboard-api-repos.ts
    src/routes/admin/dashboard-api.ts
    src/repositories/admin-dashboard.ts
    src/repositories/admin-dashboard-lists.ts
    src/repositories/admin-dashboard-types.ts
  </files>
  <action>
    Delete the file entirely:
    - `src/routes/admin/dashboard-api-repos.ts`

    Modify `src/routes/admin/dashboard-api.ts`:
    - Remove the import line: `import { reposRoutes } from "./dashboard-api-repos.js";`
    - Remove the registration line: `await server.register(reposRoutes);`

    Modify `src/repositories/admin-dashboard.ts`:
    - Remove `listAllRepositories` from the re-export on line 18 (keep `listAppsWithCounts` and `listFailedNotifications`)
    - Remove `RepoListParams` from the type re-export on line 14 (keep `AppWithCounts`, `AppDetailResult`, `RepositoryWithStatus`, `FailedNotificationResult`, `ListParams`)

    Modify `src/repositories/admin-dashboard-lists.ts`:
    - Delete the entire `listAllRepositories` function (lines 73-136)
    - Remove `RepoListParams` from the imports on line 10 (keep `AppWithCounts`, `RepositoryWithStatus`, `FailedNotificationResult`, `ListParams`)
    - Remove `AppRepositoryStatus` import from line 3 if it is only used by `listAllRepositories` (check first — it is used on line 103 inside the deleted function)

    Modify `src/repositories/admin-dashboard-types.ts`:
    - Delete the `RepoListParams` interface (lines 51-53) — no longer used anywhere
  </action>
  <verify>
    Run `cd /home/toto/scm-projects/docora && npx tsc --noEmit` — no type errors in backend.
    Confirm deleted file no longer exists: `ls src/routes/admin/dashboard-api-repos.ts` should fail.
    Grep for orphaned references: `grep -r "listAllRepositories\|reposRoutes\|RepoListParams" src/` should return zero matches.
    Run `pnpm test` to confirm no test failures (existing tests should still pass since this endpoint had no dedicated tests).
  </verify>
  <done>
    Backend repository listing endpoint deleted. Route registration removed. Dead data access function and type removed. Backend compiles and tests pass.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes (both frontend and backend)
2. `pnpm test` passes
3. Files do not exist: `dashboard/src/pages/Repositories.tsx`, `dashboard/src/pages/Repositories.module.css`, `src/routes/admin/dashboard-api-repos.ts`
4. No orphaned references: `grep -r "fetchRepositories\|listAllRepositories\|reposRoutes\|RepoListParams\|dashboard-api-repos" src/ dashboard/src/` returns nothing
5. AppDetailRepoTable still compiles and renders (verified by typecheck passing)
</verification>

<success_criteria>
- Admin dashboard has no Repositories navigation link
- /admin/repositories route does not exist (404)
- GET /admin/api/repositories endpoint does not exist (404)
- AppDetail page with its repo table is unaffected
- No dead code remains (no orphaned imports, functions, types, or files)
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-dashboard-cleanup/06-01-SUMMARY.md`
</output>
