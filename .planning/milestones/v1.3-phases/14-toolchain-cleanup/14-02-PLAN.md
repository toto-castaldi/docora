---
phase: 14-toolchain-cleanup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/ci-deploy.yml
autonomous: true
requirements:
  - CLEAN-04

must_haves:
  truths:
    - "CI workflow has no 'release' job"
    - "CI workflow does not analyze commits for version bumping"
    - "CI workflow does not create git tags"
    - "CI workflow does not push version-bump commits"
    - "build-test job still runs typecheck and tests on push/PR"
    - "docker and deploy jobs are commented out (Phase 16 will redesign them)"
  artifacts:
    - path: ".github/workflows/ci-deploy.yml"
      provides: "CI pipeline with only build-test job active"
      contains: "build-test"
  key_links:
    - from: ".github/workflows/ci-deploy.yml"
      to: "build-test"
      via: "Only active job in workflow"
      pattern: "jobs:.*build-test"
---

<objective>
Remove the CI release job and disable the docker/deploy jobs that depended on it.

Purpose: The old release job analyzed commit messages to bump versions, create tags, and push version-bump commits. This mechanism is being replaced by STATE.md-based versioning in Phase 15 and a new CI pipeline in Phase 16. The build-test job is preserved for PR validation.

Output: CI workflow with only the build-test job active. Docker and deploy jobs commented out (not deleted) so Phase 16 can reference them when redesigning the pipeline.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-toolchain-cleanup/14-CONTEXT.md
@.github/workflows/ci-deploy.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove release job and disable docker/deploy jobs in CI workflow</name>
  <files>.github/workflows/ci-deploy.yml</files>
  <action>
Edit `.github/workflows/ci-deploy.yml` to:

1. **Delete the entire `release` job** (lines 42-124) — the block starting with the comment `# Auto-Release (only on main)` through the end of the `steps` that push tags. This includes:
   - The job definition with `needs: build-test`, `if: github.ref == 'refs/heads/main'`, permissions, outputs
   - All steps: checkout with fetch-depth 0, git config, "Analyze commits and bump version" script
   - Remove completely — do not comment out (this job has no reusable parts for Phase 16)

2. **Comment out the `docker` job** (lines 126-184) — add a comment explaining why:
   ```yaml
   # ─────────────────────────────────────────────
   # Docker and Deploy jobs disabled — Phase 16 will redesign with STATE.md-based versioning
   # ─────────────────────────────────────────────
   ```
   Comment out every line of the `docker:` job definition (add `#` prefix to each line). This preserves the Docker build/push configuration as reference for Phase 16.

3. **Comment out the `deploy` job** (lines 186-217) — same approach, comment out every line. This preserves the DigitalOcean deployment configuration for Phase 16.

4. **Keep the `build-test` job exactly as-is** — this job runs typecheck and tests on every push and PR. It has no dependency on the release job and must continue working.

The resulting file should have:
- The `name`, `on`, and `env` sections unchanged
- The `build-test` job active and unchanged
- The `release` job completely removed
- The `docker` and `deploy` jobs fully commented out with explanatory comments

**Why comment out instead of delete docker/deploy:** Phase 16 (CI/CD Pipeline) will rebuild these jobs with STATE.md-based versioning. Having the existing configuration as inline reference (image names, registry, deploy host vars, scp paths) saves Phase 16 from needing to rediscover these details.
  </action>
  <verify>Run `cat .github/workflows/ci-deploy.yml | grep -c "release:"` — should return 0 (no release job). Run `cat .github/workflows/ci-deploy.yml | grep -c "build-test:"` — should return 1 (build-test preserved). Validate YAML syntax: `python3 -c "import yaml; yaml.safe_load(open('.github/workflows/ci-deploy.yml'))" && echo "VALID YAML" || echo "INVALID YAML"`</verify>
  <done>CI release job completely removed. Docker and deploy jobs commented out with Phase 16 reference note. Build-test job preserved unchanged. Workflow YAML is valid.</done>
</task>

</tasks>

<verification>
1. `.github/workflows/ci-deploy.yml` is valid YAML
2. No `release:` job exists in the workflow
3. No commit analysis, tag creation, or version-bump logic in the workflow
4. `build-test` job is present and runs typecheck + tests
5. Docker and deploy jobs are commented out (not deleted) for Phase 16 reference
</verification>

<success_criteria>
- CI pipeline no longer has a release job that analyzes commits, creates tags, or bumps versions
- build-test job runs unchanged on push to main and on pull requests
- Docker/deploy configuration preserved as comments for Phase 16
- Workflow file is syntactically valid YAML
</success_criteria>

<output>
After completion, create `.planning/phases/14-toolchain-cleanup/14-02-SUMMARY.md`
</output>
