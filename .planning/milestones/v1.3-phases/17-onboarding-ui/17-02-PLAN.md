---
phase: 17-onboarding-ui
plan: 02
type: execute
wave: 2
depends_on: [17-01]
files_modified:
  - dashboard/src/pages/Onboard.tsx
  - dashboard/src/pages/Onboard.module.css
  - dashboard/src/components/CredentialsModal.tsx
  - dashboard/src/components/CredentialsModal.module.css
autonomous: true
requirements: [ONBD-03, ONBD-04]

must_haves:
  truths:
    - "After successful onboarding, a modal appears showing the app_id and token"
    - "Each credential field has a copy-to-clipboard button"
    - "Clicking copy copies the value and shows a brief 'Copied!' confirmation"
    - "The modal displays a prominent warning that the token will not be shown again"
    - "Closing the modal resets the form for another onboarding"
    - "The token is displayed in a monospace font for readability"
  artifacts:
    - dashboard/src/components/CredentialsModal.tsx
    - dashboard/src/components/CredentialsModal.module.css
  key_links:
    - "Onboard form submit success → sets OnboardResult state → opens CredentialsModal"
    - "CredentialsModal close → clears OnboardResult state → resets form"
    - "Copy button → navigator.clipboard.writeText → visual feedback"
---

<objective>
Add a success modal that displays the generated app_id and token after successful onboarding, with copy-to-clipboard buttons and a warning that the token will not be shown again.

Purpose: The token is only returned once by the backend. The admin must be able to see and copy it immediately after onboarding. A clear warning prevents accidental dismissal without saving the token.

Output: CredentialsModal component wired to the Onboard page, displaying credentials with copy functionality and token warning.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-onboarding-ui/17-01-SUMMARY.md
@dashboard/src/components/ConfirmDialog.tsx
@dashboard/src/components/ConfirmDialog.module.css

<interfaces>
<!-- Key types and contracts the executor needs. -->

From dashboard/src/api/admin.ts (created in 17-01):
```typescript
export interface OnboardResult {
  app_id: string;
  token: string;
  created_at: string;
}
```

From dashboard/src/components/ConfirmDialog.tsx (modal pattern reference):
```typescript
// Uses native <dialog> element with showModal()/close()
// Uses useRef<HTMLDialogElement> + useEffect to sync open prop
// Backdrop click to close, onCancel handler for Escape key
// This is the established modal pattern in the codebase
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CredentialsModal component</name>
  <files>
    dashboard/src/components/CredentialsModal.tsx
    dashboard/src/components/CredentialsModal.module.css
  </files>
  <action>
  **1. Create `dashboard/src/components/CredentialsModal.tsx`:**

  Build a modal component following the ConfirmDialog pattern (native `<dialog>` element):

  Props interface:
  ```typescript
  interface CredentialsModalProps {
    open: boolean;
    appId: string;
    token: string;
    onClose: () => void;
  }
  ```

  Implementation:
  - Use `useRef<HTMLDialogElement>` + `useEffect` to sync `open` prop (same pattern as ConfirmDialog)
  - On backdrop click → call onClose
  - On Escape (onCancel) → call onClose
  - Layout:
    - Title: "App Onboarded Successfully" with a CheckCircle icon (green, from lucide-react)
    - Warning banner: Yellow/amber background with AlertTriangle icon and text: **"Save these credentials now. The token will not be shown again."**
    - Two credential rows, each with:
      - Label ("App ID" / "Token")
      - Value in a monospace-font code block with subtle gray background
      - A Copy button (Copy icon from lucide-react) on the right side of the value
    - Copy behavior: use `navigator.clipboard.writeText(value)`. On click, change the button icon to Check (green) and text to "Copied!" for 2 seconds, then revert. Use `useState` for each copy state.
    - A "Close" button at the bottom (full width, primary blue style)

  **2. Create `dashboard/src/components/CredentialsModal.module.css`:**

  Style following the ConfirmDialog pattern but wider (max-width ~520px) to accommodate long tokens:
  - `.dialog` same base as ConfirmDialog (no border, rounded, white bg, shadow, backdrop)
  - `.content` padding 1.5rem
  - `.titleRow` flex row with icon + title text
  - `.warning` amber/yellow background (#fef3c7), amber border (#f59e0b), padding, rounded, with icon + text. Text should be bold for emphasis.
  - `.credentialGroup` containing label + value row
  - `.label` small, gray, uppercase, letter-spacing
  - `.valueRow` flex row with the credential value and copy button
  - `.value` monospace font (font-family: monospace), gray background (#f3f4f6), padding, rounded, overflow-x auto, word-break break-all for long tokens
  - `.copyButton` compact button with icon, subtle border, transitions to green on "Copied!" state
  - `.copiedButton` green variant of copy button
  - `.closeButton` full-width primary blue button at the bottom
  </action>
  <verify>
    <automated>cd /home/toto/scm-projects/docora/dashboard && npx tsc --noEmit</automated>
  </verify>
  <done>CredentialsModal component exists, renders modal with app_id + token display, copy buttons, and token warning</done>
</task>

<task type="auto">
  <name>Task 2: Wire CredentialsModal to Onboard page</name>
  <files>
    dashboard/src/pages/Onboard.tsx
    dashboard/src/pages/Onboard.module.css
  </files>
  <action>
  **1. Update `dashboard/src/pages/Onboard.tsx`:**

  - Import `CredentialsModal` from `../components/CredentialsModal.js`
  - Import `OnboardResult` type from `../api/admin.js`
  - Add state: `const [result, setResult] = useState<OnboardResult | null>(null)`
  - On successful onboard API call (where 17-01 left a console.log placeholder), instead set the result:
    ```typescript
    setResult(apiResult);
    ```
  - Remove the console.log placeholder and form reset from the success handler (the modal close will handle reset)
  - Add the modal at the bottom of the JSX (after the form container):
    ```tsx
    {result && (
      <CredentialsModal
        open={!!result}
        appId={result.app_id}
        token={result.token}
        onClose={() => {
          setResult(null);
          // Reset form fields here
        }}
      />
    )}
    ```
  - In the `onClose` handler, reset all form state back to initial values (empty strings)

  **2. No CSS changes needed** — the modal has its own module. If the Onboard page needs any minor adjustments for the flow, update Onboard.module.css accordingly.
  </action>
  <verify>
    <automated>cd /home/toto/scm-projects/docora/dashboard && npx tsc --noEmit</automated>
  </verify>
  <done>
  - After successful onboarding, the CredentialsModal opens showing app_id and token
  - Each credential has a working copy-to-clipboard button with visual feedback
  - The modal shows a prominent warning about the token not being shown again
  - Closing the modal resets the form for another onboarding
  </done>
</task>

</tasks>

<verification>
1. `cd dashboard && npx tsc --noEmit` passes
2. After submitting the onboard form successfully, a modal appears
3. Modal shows app_id and token in monospace code blocks
4. Copy buttons work and show "Copied!" feedback
5. Warning about token visibility is prominent (yellow/amber)
6. Closing the modal resets the form
7. Modal closes on backdrop click and Escape key
</verification>

<success_criteria>
- After successful onboarding, modal shows app_id and token with copy-to-clipboard buttons
- Modal displays prominent warning that the token will not be shown again
- Copy buttons provide visual feedback ("Copied!") on click
- Closing the modal resets the form for another onboarding
</success_criteria>

<output>
After completion, create `.planning/phases/17-onboarding-ui/17-02-SUMMARY.md`
</output>
