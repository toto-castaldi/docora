---
phase: 09-documentation-site
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - docs-site/content/api.md
  - docs-site/content/webhooks.md
autonomous: true

must_haves:
  truths:
    - "API page documents POST /api/apps/onboard with request/response schemas"
    - "API page documents POST /api/repositories with request/response schemas"
    - "API page documents DELETE /api/repositories/:repository_id"
    - "API page documents PATCH /api/repositories/:repository_id/token"
    - "Webhook page documents all four notification types: create, update, delete, sync_failed"
    - "User can navigate from homepage to API docs and webhook docs"
  artifacts:
    - path: "docs-site/content/api.md"
      provides: "Full API reference for all Docora endpoints"
      contains: "POST /api/apps/onboard"
    - path: "docs-site/content/webhooks.md"
      provides: "Webhook reference for all notification types"
      contains: "POST /sync_failed"
  key_links:
    - from: "docs-site/content/api.md"
      to: "docs-site/content/webhooks.md"
      via: "Cross-reference links between API and webhook docs"
      pattern: "/webhooks/"
---

<objective>
Create the API documentation page and move existing webhook documentation to its own section page, completing the multi-page docs site.

Purpose: Developers integrating with Docora have a complete reference for both calling Docora's API and implementing webhook handlers.
Output: Two content pages — API reference and Webhook reference — with accurate schemas matching the codebase.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-documentation-site/09-01-SUMMARY.md

@src/schemas/apps.ts
@src/schemas/repositories.ts
@src/routes/apps/onboard.ts
@src/routes/repositories/register.ts
@src/routes/repositories/unwatch.ts
@src/routes/repositories/update-token.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create API documentation page</name>
  <files>docs-site/content/api.md</files>
  <action>
    Create `docs-site/content/api.md` with frontmatter:
    ```yaml
    ---
    title: "API Reference"
    ---
    ```

    Write complete API documentation following the same visual style as the existing webhook docs (endpoint badge divs, JSON code blocks, field tables). Reference the actual Zod schemas in `src/schemas/apps.ts` and `src/schemas/repositories.ts` for accuracy.

    **Intro section** (use div.intro like webhook page):
    - Brief explanation: Docora exposes a REST API for app onboarding and repository management. All endpoints except onboarding require bearer token authentication.

    **Authentication section:**
    - All requests (except POST /api/apps/onboard) require `Authorization: Bearer <token>` header
    - The token is returned during onboarding
    - Include a curl example showing the Authorization header

    **Section: POST /api/apps/onboard**
    - Use `<div class="endpoint"><span class="badge badge-post">POST</span>` pattern
    - Public endpoint (no auth required)
    - Request body fields from OnboardRequestSchema:
      | Field | Type | Required | Description |
      | base_url | string | Yes | Webhook URL for receiving updates (HTTPS required in production) |
      | app_name | string | Yes | Application name (3-100 chars) |
      | email | string | Yes | Contact email |
      | website | string | No | Application website URL |
      | description | string | No | Short description (max 500 chars) |
      | client_auth_key | string | Yes | Secret key for HMAC webhook signature verification (min 16 chars) |
    - Response 201 fields from OnboardResponseSchema:
      | Field | Type | Description |
      | app_id | string | Unique application identifier |
      | token | string | Bearer token for API authentication |
      | created_at | string | ISO 8601 creation timestamp |
    - Include JSON request/response examples
    - Add alert box: "Store the token and client_auth_key securely. The token authenticates your API calls. The client_auth_key is used to verify incoming webhooks."

    **Section: POST /api/repositories**
    - Requires bearer token auth
    - Request body from RegisterRepositoryRequestSchema:
      | Field | Type | Required | Description |
      | github_url | string | Yes | GitHub repository URL (https://github.com/owner/repo) |
      | github_token | string | No | GitHub personal access token (required for private repos, starts with ghp_ or github_pat_) |
    - Response 201 from RegisterRepositoryResponseSchema:
      | Field | Type | Description |
      | repository_id | string | Docora repository identifier |
      | github_url | string | Full GitHub URL |
      | owner | string | Repository owner |
      | name | string | Repository name |
      | is_private | boolean | Whether the repository is private |
      | created_at | string | ISO 8601 creation timestamp |
    - Error responses: 401 Unauthorized, 404 Repository not found on GitHub, 422 Invalid GitHub URL
    - Note: Re-registering an already-watched repository will unwatch and re-register it (fresh scan)
    - Include JSON request/response examples

    **Section: DELETE /api/repositories/:repository_id**
    - Requires bearer token auth
    - Path parameter: repository_id (format: repo_ followed by 24 hex chars)
    - Use `<span class="badge badge-delete">DELETE</span>` (add CSS for badge-delete in this task if not already present — use coral/red color)
    - Response: 204 No Content on success
    - Error responses: 401 Unauthorized, 404 Repository not found or not registered for this app
    - Brief explanation: Stops watching the repository and cleans up delivery history for this app

    **Section: PATCH /api/repositories/:repository_id/token**
    - Requires bearer token auth
    - Path parameter: repository_id
    - Use `<span class="badge badge-patch">PATCH</span>` (add CSS for badge-patch — use violet/purple color)
    - Request body from UpdateTokenRequestSchema:
      | Field | Type | Required | Description |
      | github_token | string | Yes | New GitHub personal access token |
    - Response 200 from UpdateTokenResponseSchema:
      | Field | Type | Description |
      | message | string | "Token updated successfully" |
    - Error responses: 401, 404 not linked, 422 token cannot access repo
    - Note: This resets error state and circuit breaker, triggering a fresh scan
    - Cross-reference: "If you receive a [sync_failed webhook](/webhooks/#post-sync_failed), use this endpoint to rotate the token"

    **Error Responses section:**
    - All error responses follow: `{ "error": "Description of what went wrong" }`
    - Common status codes table: 401, 404, 422, 500
  </action>
  <verify>
    Run `cd /home/toto/scm-projects/docora/docs-site && hugo --noBuildLock 2>&1` to confirm build succeeds. Grep the built `public/api/index.html` for all four endpoints: "apps/onboard", "api/repositories", "repository_id/token", "DELETE".
  </verify>
  <done>API page documents all four endpoints (onboard, register, unwatch, token update) with request/response schemas matching the actual Zod schemas in the codebase.</done>
</task>

<task type="auto">
  <name>Task 2: Move webhook documentation to section page and add badge CSS</name>
  <files>
    docs-site/content/webhooks.md
    docs-site/static/css/style.css
  </files>
  <action>
    Create `docs-site/content/webhooks.md`:
    - Frontmatter: `title: "Webhook Reference"`
    - Copy the ENTIRE content from the old `_index.md` webhook documentation (which was the full page content before Plan 09-01 replaced it with the homepage)
    - The old content is available in git history or can be reconstructed from the existing `_index.md` that was read during planning. The content includes: Overview, Authentication (HMAC-SHA256), Endpoints (create, update, delete, sync_failed), Payload Structure, Binary Files, Chunking, Error Handling, Response Format
    - Update the intro div text to: "Docora sends real-time HTTP POST notifications to your application when repository files change or sync failures occur. This page covers the webhook endpoints your app must implement."
    - Change the h1 from "Webhook API Documentation" to just use Hugo's title rendering (remove the manual h1 since single.html layout will render it or the content starts with ## sections)
    - Add a cross-reference at the top (after intro): "To register your app and start receiving webhooks, see the [API Documentation](/api/)."
    - Ensure the sync_failed section references PATCH endpoint with link: "[PATCH /api/repositories/:repository_id/token](/api/#patch-apirepositoriesrepository_idtoken)"

    Update `docs-site/static/css/style.css` — ADD these badge styles (if not added in 09-01):
    - `.badge-get`: background #4caf50 (green), color white
    - `.badge-delete`: background var(--color-coral), color white
    - `.badge-patch`: background var(--color-violet), color white
  </action>
  <verify>
    Run `cd /home/toto/scm-projects/docora/docs-site && hugo --noBuildLock 2>&1` to confirm build. Grep `public/webhooks/index.html` for all four webhook types: "create", "update", "delete", "sync_failed". Also verify cross-reference link to API docs exists.
  </verify>
  <done>Webhook page contains all existing documentation (create, update, delete, sync_failed) with cross-references to API docs. CSS has badge styles for all HTTP methods.</done>
</task>

</tasks>

<verification>
1. `cd docs-site && hugo --noBuildLock` builds without errors
2. `public/api/index.html` contains all four API endpoints with schemas
3. `public/webhooks/index.html` contains all four notification types
4. Cross-references work between API and webhook pages
5. Navigation links resolve to all three pages (/, /api/, /webhooks/)
6. All documented request/response fields match the Zod schemas in `src/schemas/apps.ts` and `src/schemas/repositories.ts`
</verification>

<success_criteria>
- API documentation covers onboard, register, unwatch, and token update with accurate schemas
- Webhook documentation covers create, update, delete, and sync_failed (content preserved from existing docs)
- Pages cross-reference each other where relevant
- Hugo site builds successfully with all three content pages
</success_criteria>

<output>
After completion, create `.planning/phases/09-documentation-site/09-02-SUMMARY.md`
</output>
